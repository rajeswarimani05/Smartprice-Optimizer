{% extends "base.html" %}
{% block content %}
<div class="container mt-5">
  <div class="row">
    <div class="col-md-5">
      {% if 'http' in product.image %}
        <img src="{{ product.image }}" class="img-fluid rounded shadow" alt="{{ product.name }}">
      {% else %}
        <img src="{{ url_for('static', filename=product.image) }}" class="img-fluid rounded shadow" alt="{{ product.name }}">
      {% endif %}
    </div>
    <div class="col-md-7">
      <h2>{{ product.name }}</h2>
      <p class="text-muted">{{ product.category }}</p>
      <p>{{ product.description }}</p>
      <h4 class="text-success">‚Çπ{{ product.base_price }}</h4>

      {% if current_user.is_authenticated %}
      <form action="{{ url_for('add_to_cart', pid=product.id) }}" method="POST" class="mt-3">
        <div class="input-group mb-3" style="max-width: 180px;">
          <input type="number" name="qty" min="1" value="1" class="form-control text-center">
          <button type="submit" class="btn btn-warning">Add to Cart</button>
        </div>
      </form>
      {% else %}
      <p class="mt-3">
        <a href="{{ url_for('login') }}" class="btn btn-primary">Login to Add to Cart</a>
      </p>
      {% endif %}
      {% if current_user.is_authenticated %}
  <button class="btn btn-outline-primary mt-2" id="negotiate-btn">ü§ù Negotiate Price</button>

  <div id="nego-result" class="mt-3 text-success fw-bold" style="display:none;"></div>

  <script>
    document.getElementById("negotiate-btn").addEventListener("click", async function() {
      const res = await fetch("{{ url_for('auto_negotiate', pid=product.id) }}");
      const data = await res.json();
      document.getElementById("nego-result").style.display = "block";
      document.getElementById("nego-result").innerText =
        `ü§ñ Offer: ‚Çπ${data.final_price} (You saved ‚Çπ${data.discount})`;
    });
  </script>
{% else %}
  <p><a href="{{ url_for('login') }}" class="btn btn-warning">Login to Negotiate</a></p>
{% endif %}

    </div>
  </div>
</div>
{% endblock %}
